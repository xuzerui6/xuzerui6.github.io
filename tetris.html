<!DOCTYPE html>
<html>
<head>
    <title>手机版俄罗斯方块</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { 
            background: #333; 
            margin: 0; 
            touch-action: none; /* 禁止页面滚动 */
        }
        #game-container {
            position: relative;
            width: 300px;
            margin: 20px auto;
        }
        #score {
            color: white;
            font-size: 20px;
            text-align: center;
            padding: 10px;
        }
        #controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .btn {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="score">分数: 0</div>
    <div id="game-container">
        <canvas id="game" width="300" height="600"></canvas>
        <div id="controls">
            <div style="display: flex; gap: 20px;">
                <div class="btn" id="left">←</div>
                <div class="btn" id="right">→</div>
            </div>
            <div style="display: flex; gap: 20px;">
                <div class="btn" id="rotate">↻</div>
                <div class="btn" id="down">↓</div>
            </div>
        </div>
    </div>

    <script>
        // 之前的游戏代码保持不变，只增加以下触摸控制部分 ▼▼▼
        
        // 获取按钮元素
        const leftBtn = document.getElementById('left');
        const rightBtn = document.getElementById('right');
        const rotateBtn = document.getElementById('rotate');
        const downBtn = document.getElementById('down');

        // 触摸事件处理
        function addButtonControl(element, action) {
            let isTouching = false;
            element.addEventListener('touchstart', (e) => {
                e.preventDefault();
                isTouching = true;
                handleAction(action);
            });
            element.addEventListener('touchend', () => {
                isTouching = false;
            });
            element.addEventListener('touchmove', (e) => {
                e.preventDefault();
            });
        }

        // 绑定按钮动作
        addButtonControl(leftBtn, 'left');
        addButtonControl(rightBtn, 'right');
        addButtonControl(rotateBtn, 'rotate');
        addButtonControl(downBtn, 'down');

        // 执行动作函数
        function handleAction(action) {
            if (!current) return;
            switch(action) {
                case 'left':
                    x--;
                    if (collision()) x++;
                    break;
                case 'right':
                    x++;
                    if (collision()) x--;
                    break;
                case 'rotate':
                    const rotated = current.shape[0].map((_, i) =>
                        current.shape.map(row => row[i]).reverse()
                    );
                    const oldShape = current.shape;
                    current.shape = rotated;
                    if (collision()) current.shape = oldShape;
                    break;
                case 'down':
                    y++;
                    if (collision()) {
                        y--;
                        merge();
                    }
                    break;
            }
            draw();
        }

        // 其他游戏代码保持不变（之前完整版的所有代码） ▲▲▲
    </script>
</body>
</html>